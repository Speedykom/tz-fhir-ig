map "http://speedykom.org/tz-fhir-ig/StructureMap/CardDetailsToPatient" = CardDetailsToPatient

// Logical model (source)
uses "http://speedykom.org/tz-fhir-ig/StructureDefinition/CardDetails" alias CardDetails as source

// Target FHIR resource
uses "http://hl7.org/fhir/StructureDefinition/Patient" alias Patient as target

group CardDetailsToPatient(source src : CardDetails, target tgt : Patient) {
  
  // Card Number â†’ Patient.identifier
  src.CardNo -> tgt.identifier as id, id.system = "http://moh.tz/identifier/cardno", id.value = src.CardNo;
  
  // Name fields
  src.FirstName -> tgt.name.given = src.FirstName;
  src.LastName  -> tgt.name.family = src.LastName;
  
  // Birthdate
  src.DateOfBirth -> tgt.birthDate = src.DateOfBirth;

  // Gender translation via ConceptMap
  src.Gender -> tgt.gender = translate(src.Gender,
    'http://speedykom.org/tz-fhir-ig/ConceptMap/GenderCodes-TZ',
    'code');
}
